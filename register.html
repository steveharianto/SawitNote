<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daftar - SawitNote</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'sawit-green': '#2E7D32',
            'sawit-brown': '#8D6E63',
          },
          fontFamily: {
            'poppins': ['Poppins', 'sans-serif'],
          },
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 font-poppins min-h-screen flex flex-col items-center justify-center">
  <div class="w-full max-w-md p-6 bg-white rounded-lg shadow-md">
    <div class="flex flex-col items-center mb-6">
      <img src="images/logo.png" alt="SawitNote Logo" class="h-20 mb-2">
      <h1 class="text-sawit-green text-2xl font-bold">SawitNote</h1>
      <p class="text-gray-600 text-sm text-center">Daftar Akun Baru</p>
    </div>

    <form id="registerForm" class="space-y-4">
      <div>
        <label for="nama_lengkap" class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap</label>
        <input type="text" id="nama_lengkap" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-sawit-green focus:border-sawit-green" placeholder="Masukkan nama lengkap" required>
      </div>
      
      <div>
        <label for="nomor_pekerja" class="block text-sm font-medium text-gray-700 mb-1">Nomor Pekerja</label>
        <input type="text" id="nomor_pekerja" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-sawit-green focus:border-sawit-green" placeholder="Contoh: 2023-xxx" required>
      </div>
      
      <div>
        <label for="role" class="block text-sm font-medium text-gray-700 mb-1">Jabatan</label>
        <select id="role" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-sawit-green focus:border-sawit-green" required>
          <option value="" disabled selected>Pilih jabatan</option>
          <option value="Pemanen">Pemanen</option>
          <option value="Mandor">Mandor</option>
          <option value="Admin">Admin</option>
        </select>
      </div>
      
      <div>
        <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Nomor Telepon</label>
        <input type="tel" id="phone" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-sawit-green focus:border-sawit-green" placeholder="Contoh: 08xx-xxxx-xxxx" required>
      </div>
      
      <div>
        <label for="blok" class="block text-sm font-medium text-gray-700 mb-1">Blok Utama</label>
        <div class="flex gap-2 flex-wrap">
          <div class="flex items-center">
            <input type="checkbox" id="blok-a1" value="A1" class="mr-1 text-sawit-green">
            <label for="blok-a1" class="text-sm">A1</label>
          </div>
          <div class="flex items-center">
            <input type="checkbox" id="blok-a2" value="A2" class="mr-1 text-sawit-green">
            <label for="blok-a2" class="text-sm">A2</label>
          </div>
          <div class="flex items-center">
            <input type="checkbox" id="blok-b1" value="B1" class="mr-1 text-sawit-green">
            <label for="blok-b1" class="text-sm">B1</label>
          </div>
          <div class="flex items-center">
            <input type="checkbox" id="blok-b2" value="B2" class="mr-1 text-sawit-green">
            <label for="blok-b2" class="text-sm">B2</label>
          </div>
          <div class="flex items-center">
            <input type="checkbox" id="blok-c1" value="C1" class="mr-1 text-sawit-green">
            <label for="blok-c1" class="text-sm">C1</label>
          </div>
          <div class="flex items-center">
            <input type="checkbox" id="blok-c2" value="C2" class="mr-1 text-sawit-green">
            <label for="blok-c2" class="text-sm">C2</label>
          </div>
        </div>
      </div>
      
      <div>
        <label for="supervisor" class="block text-sm font-medium text-gray-700 mb-1">Nama Mandor</label>
        <input type="text" id="supervisor" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-sawit-green focus:border-sawit-green" placeholder="Masukkan nama mandor" required>
      </div>
      
      <div>
        <label for="pin" class="block text-sm font-medium text-gray-700 mb-1">PIN</label>
        <input type="password" id="pin" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-sawit-green focus:border-sawit-green" placeholder="Minimal 4 digit" minlength="4" required>
      </div>
      
      <div>
        <label for="confirm_pin" class="block text-sm font-medium text-gray-700 mb-1">Konfirmasi PIN</label>
        <input type="password" id="confirm_pin" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-sawit-green focus:border-sawit-green" placeholder="Masukkan PIN lagi" minlength="4" required>
      </div>

      <div id="error-message" class="hidden bg-red-100 text-red-700 p-2 rounded-md text-sm"></div>
      
      <button type="submit" class="w-full bg-sawit-green hover:bg-green-800 text-white font-medium py-2 rounded-md transition duration-300 flex items-center justify-center">
        Daftar Sekarang
      </button>
      
      <div class="text-center">
        <a href="index.html" class="text-sawit-green hover:underline text-sm">
          <i class="fas fa-arrow-left mr-1"></i> Kembali ke halaman masuk
        </a>
      </div>
    </form>
  </div>

  <!-- Success Modal -->
  <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 w-11/12 max-w-md">
      <div class="text-center mb-4">
        <div class="inline-flex items-center justify-center h-12 w-12 rounded-full bg-green-100 text-sawit-green mb-4">
          <i class="fas fa-check text-xl"></i>
        </div>
        <h3 class="text-lg font-medium text-gray-900">Pendaftaran Berhasil!</h3>
        <p class="text-gray-600 mt-1">Akun Anda telah berhasil didaftarkan.</p>
      </div>
      <button id="btn-continue" class="w-full py-2 bg-sawit-green text-white rounded-md hover:bg-green-800 transition duration-200">
        Lanjutkan ke Login
      </button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const registerForm = document.getElementById('registerForm');
      
      registerForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form values
        const name = document.getElementById('nama_lengkap').value;
        const employeeId = document.getElementById('nomor_pekerja').value;
        const role = document.getElementById('role').value;
        const phone = document.getElementById('phone').value;
        const supervisor = document.getElementById('supervisor').value;
        const pin = document.getElementById('pin').value;
        const confirmPin = document.getElementById('confirm_pin').value;
        
        // Get selected blocks
        const selectedBlocks = [];
        document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
          selectedBlocks.push(checkbox.value);
        });
        
        // Validate form
        const errorMessage = document.getElementById('error-message');
        
        if (pin !== confirmPin) {
          errorMessage.innerText = 'PIN dan konfirmasi PIN tidak cocok';
          errorMessage.classList.remove('hidden');
          return;
        }
        
        if (selectedBlocks.length === 0) {
          errorMessage.innerText = 'Pilih minimal satu blok';
          errorMessage.classList.remove('hidden');
          return;
        }
        
        // Create user object
        const userData = {
          id: employeeId,
          name: name,
          role: role,
          blocks: selectedBlocks,
          phone: phone,
          startDate: new Date().toLocaleDateString('id-ID', {
            day: 'numeric',
            month: 'long',
            year: 'numeric'
          }),
          supervisor: supervisor,
          pin: pin, // In a real app, we would hash this
          stats: {
            totalBunches: 0,
            workDays: 0
          }
        };
        
        // Store in localStorage
        // Get existing users or create new array
        const existingUsers = JSON.parse(localStorage.getItem('sawit_users') || '[]');
        
        // Check if user with same ID already exists
        const userExists = existingUsers.some(user => user.id === employeeId);
        
        if (userExists) {
          errorMessage.innerText = 'Nomor pekerja sudah terdaftar';
          errorMessage.classList.remove('hidden');
          return;
        }
        
        // Add new user
        existingUsers.push(userData);
        localStorage.setItem('sawit_users', JSON.stringify(existingUsers));
        
        // Also set as current user for demo purposes
        localStorage.setItem('sawit_user', JSON.stringify(userData));
        
        // If new account, create empty harvest history
        if (!localStorage.getItem('sawit_harvests')) {
          localStorage.setItem('sawit_harvests', JSON.stringify([]));
        }
        
        // Show success modal
        document.getElementById('success-modal').classList.remove('hidden');
      });
      
      // Handle continue button on success modal
      document.getElementById('btn-continue').addEventListener('click', function() {
        window.location.href = 'dashboard.html';
      });
    });
  </script>
</body>
</html>
